const e=function(e){};e.prototype={},e.init=(e={})=>{const t={tms:"debug",datalayerVariableNames:["auto"],debug:!1,observe:!1,data_elements:!1,start:!1,play:!1,pause:!1,mute:!1,unmute:!1,complete:!1,seek:!1,progress:!1,progress_tracking_method:"percentages",progress_percentages:[],progress_thresholds:[],...e},a=function(){t.debug&&Function.apply.call(console.log,console,arguments)};a("[ADSLU::DEBUG] - @thyngster / HTML MEDIA ELEMENTS TRACKING",t),window.google_tag_manager&&t.tms.match(/gtm|gtag/)&&!t.dataLayer&&"auto"===t.datalayerVariableNames[0]&&(t.datalayerVariableNames=Object.entries(window.google_tag_manager).filter((e=>!!e[1].gtmDom&&e)).map((e=>e[0]))),"auto"===t.datalayerVariableNames[0]&&(t.datalayerVariableNames=null);const r=e=>{const t=e.getBoundingClientRect();return!(t.top<0||t.left<0||t.bottom>(window.innerHeight||document.documentElement.clientHeight)||t.right>(window.innerWidth||document.documentElement.clientWidth))},d=e=>{if(e.getAttribute("data-html-media-element-tracked"))return;const a=Math.random().toString(36).slice(2);e.setAttribute("data-html-media-element-id",a),e.setAttribute("data-html-media-element-tracked",Math.round(1*new Date/1e3)),s[a]={progressMarkers:{},type:e.nodeName.toLowerCase(),greatest_marker:0,playEvent:!1,muted:!1,currentTime:0,state:"loaded",elapsedTime:0,lastUpdateTime:1*new Date,elementData:{}};const r=JSON.parse(JSON.stringify(e.dataset));for(const e in r){const t=e.match(/^htmlMediaElementParam(.+)/);t&&(s[a].elementData[t[1].toLowerCase()]=r[e])}"percentages"===t.progress_tracking_method&&t.progress_percentages.forEach((e=>{s[a].progressMarkers[e]=!1})),e.addEventListener("play",n,!1),e.addEventListener("pause",n,!1),e.addEventListener("ended",n,!1),e.addEventListener("timeupdate",n,!1),e.addEventListener("seeked",n,!1),e.addEventListener("volumechange",n,!1),e.addEventListener("error",n,!1)},n=e=>{const d=e.target.nodeName.toLowerCase(),n="gtm"===t.tms?"gtm.":"",m={event:`${n}${d}`,[`${n}elementClasses`]:e.target.className||"",[`${n}elementId`]:e.for||e.target.dataset.htmlMediaElementId||"",[`${n}elementTarget`]:e.target||"",[`${n}element`]:e.srcElement||"",[`${n}elementUrl`]:e.baseURI||document.location.href,[`${n}${d}Provider`]:"html5",[`${n}${d}Status`]:e.type,[`${n}${d}Url`]:e.target.currentSrc,[`${n}${d}Title`]:e.target.getAttribute("data-html-media-element-title")&&t.data_elements?e.target.getAttribute("data-html-media-element-title"):decodeURIComponent(e.target.currentSrc.split("/")[e.target.currentSrc.split("/").length-1]),[`${n}${d}Duration`]:Math.round(e.target.duration),[`${n}${d}CurrentTime`]:Math.round(e.target.currentTime),[`${n}${d}ElapsedTime`]:Math.round(s[e.target.dataset.htmlMediaElementId].elapsedTime/1e3),[`${n}${d}Percent`]:Math.floor(100*e.target.currentTime/e.target.duration),[`${n}${d}Visible`]:r(e.target),[`${n}${d}IsMuted`]:e.target.muted,[`${n}${d}PlaybackRate`]:e.target.playbackRate,[`${n}${d}Loop`]:e.target.loop,[`${n}${d}Volume`]:e.target.volume,[`${n}${d}NetworkState`]:e.target.networkState,[`${n}${d}Data`]:s[e.target.dataset.htmlMediaElementId].elementData,elementNodeName:e.target.nodeName?e.target.nodeName.toLowerCase():"video"};let l=!1;switch(e.type){case"volumechange":!0===m[`${n}${d}IsMuted`]||0===m[`${n}${d}Volume`]?(s[e.target.dataset.htmlMediaElementId].muted=!0,m[`${n}${d}Status`]="mute"):!0===s[e.target.dataset.htmlMediaElementId].muted&&!1===m[`${n}${d}IsMuted`]&&(s[e.target.dataset.htmlMediaElementId].muted=!1,m[`${n}${d}Status`]="unmute");break;case"seeked":m[`${n}${d}Status`]="seek",s[e.target.dataset.htmlMediaElementId].playEvent=!1;break;case"timeupdate":s[e.target.dataset.htmlMediaElementId].currentTime=Math.round(e.target.currentTime);let t=1*new Date;s[e.target.dataset.htmlMediaElementId].elapsedTime=s[e.target.dataset.htmlMediaElementId].elapsedTime+(t-s[e.target.dataset.htmlMediaElementId].lastUpdateTime),s[e.target.dataset.htmlMediaElementId].lastUpdateTime=t,Object.entries(s[e.target.dataset.htmlMediaElementId].progressMarkers).forEach((t=>{const[a]=t;m[`${n}${d}Percent`]>=a&&a>s[e.target.dataset.htmlMediaElementId].greatest_marker&&(s[e.target.dataset.htmlMediaElementId].greatest_marker=a)})),s[e.target.dataset.htmlMediaElementId].greatest_marker&&!s[e.target.dataset.htmlMediaElementId].progressMarkers[s[e.target.dataset.htmlMediaElementId].greatest_marker]&&(s[e.target.dataset.htmlMediaElementId].progressMarkers[s[e.target.dataset.htmlMediaElementId].greatest_marker]=!0,m[`${n}${d}Status`]="progress",m[`${n}${d}Percent`]=parseInt(s[e.target.dataset.htmlMediaElementId].greatest_marker));break;case"play":s[e.target.dataset.htmlMediaElementId].lastUpdateTime=1*new Date,"loaded"===s[e.target.dataset.htmlMediaElementId].state?(s[e.target.dataset.htmlMediaElementId].state="playing",m[`${n}${d}Status`]="start"):l=!0;break;case"pause":s[e.target.dataset.htmlMediaElementId].state="paused",100!==m[`${n}${d}Status`]&&!0!==e.target.seeking&&Math.round(e.target.currentTime)!==Math.round(e.target.duration)||(l=!0),s[e.target.dataset.htmlMediaElementId].playEvent=!0;break;case"ended":m[`${n}${d}Status`]="complete",s[e.target.dataset.htmlMediaElementId].playEvent=!0;break;case"error":m[`${n}${d}ErrorCode`]=e.target.error.code,m[`${n}${d}ErrorMessage`]=e.target.error.message}l||(e=>{var r="gtm"===t.tms?"gtm.":"";if(t[e[`${r}${e.elementNodeName}Status`]])switch(t.tms){case"gtm":t.datalayerVariableNames?t.datalayerVariableNames.forEach((t=>{try{window[t].push(e)}catch(e){}})):t.debug&&a("[ADSLU::DEBUG] - Defined TMS not found");break;case"tealium":window.utag&&window.utag.link?window.utag.link(e):a("[ADSLU::DEBUG] - Defined TMS not found"),a("[ADSLU::DEBUG] - TEALIUM",e);break;case"debug":a("[ADSLU::DEBUG - HTML Element Event]",e)}})(m)},s={},m=[...document.getElementsByTagName("audio"),...document.getElementsByTagName("video")];a(`[ADSLU::DEBUG] - FOUND ${Object.keys(m).length} ELEMENTS`,m),m.forEach((e=>{d(e)})),t.observe&&(a("[ADSLU::DEBUG - OBSERVER ENABLED]"),window.MutationObserver&&new MutationObserver((function(e){e.forEach((function(e){e.addedNodes.forEach((e=>{"VIDEO"===e.tagName&&(a("[NEW VIDEO::mutation]",e),d(e))}))}))})).observe(document.body,{attributes:!0,childList:!0,subtree:!0,characterData:!0}))};export default e;
